/* empty css                                                                  */import{g as O,i as b,a as s,c as a,k as h,B as u,b as n,t as r,F as p,f as C,l as i,y,m as U,j as T,J as L,_ as F,e as x,p as Z,d as z}from"./index-d2b97ff0.js";import{Z as N}from"./ZySectionHeader-aeeaaa3a.js";import{Z as B}from"./ZyPageHeader-e21cef00.js";import{Z as w,m as D,b as M,c as V,d as E,a as J}from"./api.messages-25244f10.js";import{T as P}from"./util.time-c27b4c72.js";import"./server-aba1ee1f.js";/* empty css                                                               */const q=function(e,o,d){let m="";if(d){const k=new Date;k.setTime(k.getTime()+d*24*60*60*1e3),m=`; expires=${k.toUTCString()}`}document.cookie=`${e}=${encodeURIComponent(o)}${m}; path=/`},R=function(e){const o=document.cookie.split("; ").find(d=>d.startsWith(`${e}=`));return o?decodeURIComponent(o.split("=")[1]):null};const j={key:0,class:"comment"},H=["href"],Y={class:"nickname"},G={key:0,class:"author"},W=["href"],K={class:"nickname"},Q={key:0,class:"author"},X=["href"],ee={class:"nickname"},te={key:0,class:"author"},ne=["href"],oe={class:"nickname"},se={key:0,class:"author"},ae=["href"],ie={class:"nickname"},ce={key:0,class:"author"},me=["href"],re={class:"nickname"},le={key:0,class:"author"},ue={class:"date"},de={class:"reply-box"},fe={class:"reply-box"},A={__name:"comment",props:{comment:{type:Object},pid:{type:String}},emits:["reply","like","oppose"],setup(e,{emit:o}){const d=e,m=O({show:{replies:!1},likeActive:R(`comment-like-${d.comment._id}`),opposeActive:R(`comment-oppose-${d.comment._id}`)}),k=l=>{m.likeActive||(m.likeActive=!0,o("like",l))},I=l=>{m.opposeActive||(m.opposeActive=!0,o("oppose",l))},v=()=>{m.show.replies=!m.show.replies},S=l=>{let t={...d.comment,pid:d.pid};o("reply",[t,l])};return(l,t)=>{const c=b("a-popover"),g=b("a-image"),_=b("a-comment");return e.comment.userInfo.length?(s(),a("section",j,[h(_,{id:"comment-"+e.comment._id},{actions:u(()=>[n("span",null,"From"+r(e.comment.userInfo[0].platform||"未知"),1),e.comment.toUser?i("",!0):(s(),a(p,{key:0},[n("span",{class:C({active:m.likeActive}),onClick:t[0]||(t[0]=f=>k(e.comment._id))},"Like("+r(e.comment.likeNum||0)+")",3),n("span",{class:C({active:m.opposeActive}),onClick:t[1]||(t[1]=f=>I(e.comment._id))},"Dislike("+r(e.comment.opposeNum||0)+")",3)],64)),n("span",{onClick:v},"Reply")]),author:u(()=>[e.comment.toUser?i("",!0):(s(),a(p,{key:0},[e.comment.userInfo[0].website?(s(),y(c,{key:0},{content:u(()=>[n("p",null,"点击访问 "+r(e.comment.userInfo[0].nickname)+" 的主页",1)]),default:u(()=>[n("a",{href:e.comment.userInfo[0].website,target:"_blank"},[n("span",Y,r(e.comment.userInfo[0].nickname),1),e.comment.userInfo[0].username==="admin"?(s(),a("span",G)):i("",!0)],8,H)]),_:1})):(s(),a("a",{key:1,href:e.comment.userInfo[0].website,target:"_blank"},[n("span",K,r(e.comment.userInfo[0].nickname),1),e.comment.userInfo[0].username==="admin"?(s(),a("span",Q)):i("",!0)],8,W))],64)),e.comment.toUser?(s(),a(p,{key:1},[e.comment.userInfo[0].website?(s(),a(p,{key:0},[h(c,null,{content:u(()=>[n("p",null,"点击访问 "+r(e.comment.userInfo[0].nickname)+" 的主页",1)]),default:u(()=>[n("a",{href:e.comment.userInfo[0].website,target:"_blank"},[n("span",ee,r(e.comment.userInfo[0].nickname),1),e.comment.userInfo[0].username==="admin"?(s(),a("span",te)):i("",!0)],8,X)]),_:1}),U(" @ "),h(c,null,{content:u(()=>[n("p",null,"点击访问 "+r(e.comment.toUserInfo[0].nickname)+" 的主页",1)]),default:u(()=>[n("a",{href:e.comment.toUserInfo[0].website,target:"_blank"},[n("span",oe,r(e.comment.toUserInfo[0].nickname),1),e.comment.toUserInfo[0].username==="admin"?(s(),a("span",se)):i("",!0)],8,ne)]),_:1})],64)):(s(),a(p,{key:1},[n("a",{href:e.comment.userInfo[0].website,target:"_blank"},[n("span",ie,r(e.comment.userInfo[0].nickname),1)],8,ae),e.comment.userInfo[0].username==="admin"?(s(),a("span",ce)):i("",!0),U(" @ "),n("a",{href:e.comment.toUserInfo[0].website,target:"_blank"},[n("span",re,r(e.comment.toUserInfo[0].nickname),1),e.comment.toUserInfo[0].username==="admin"?(s(),a("span",le)):i("",!0)],8,me)],64))],64)):i("",!0),n("div",ue,"said "+r(T(P).formatRelativeTime(e.comment.createdAt))+" ago:",1)]),avatar:u(()=>[h(g,{previewMask:!1,width:40,src:e.comment.userInfo[0].avatar,alt:"匿名"},null,8,["src"])]),content:u(()=>[n("p",null,r(e.comment.content),1)]),default:u(()=>[e.comment.toUser?(s(),a(p,{key:0},[n("div",de,[L(l.$slots,"default")]),m.show.replies?(s(),y(w,{key:0,onSubmitForm:S})):i("",!0)],64)):i("",!0),e.comment.toUser?i("",!0):(s(),a(p,{key:1},[m.show.replies?(s(),y(w,{key:0,onSubmitForm:S})):i("",!0),n("div",fe,[L(l.$slots,"default")])],64))]),_:3},8,["id"])])):i("",!0)}}};const pe=e=>(Z("data-v-e2ed695c"),e=e(),z(),e),he={class:"contact-box"},ke={class:"contact-main"},ge={class:"fit-form c-mb-60 c-mt-60"},ye=pe(()=>n("div",{class:"contact-anchor"},null,-1)),_e={class:"contact-head c-mb-40 c-mt-60"},be={class:"c-mb-40"},Ie={class:"message-list"},ve={key:0,class:"pagination"},Se={__name:"index",setup(e){const o=O({query:{pagination:{current:1,pageSize:10,total:0,hideOnSinglePage:!0}},total:0,messageList:[],show:{replies:!1}}),d=t=>{document.querySelector(t).scrollIntoView({behavior:"smooth"})},m=(t=1)=>{o.query.pagination.current=t,l(),d(".contact-anchor")},k=t=>{M({_id:t}).then(c=>{c.status&&(q(`comment-like-${t}`,!0,30),l())})},I=t=>{V({_id:t}).then(c=>{c.status&&(q(`comment-oppose-${t}`,!0,30),l())})},v=([t,c])=>{let g={message:t.pid?t.pid:t._id,toUser:t.userInfo[0]._id,...c};E(g).then(_=>{if(_.status){let f={name:c.name,email:c.email,website:c.website};localStorage.setItem("ZY-CLIENT-USERINFO",JSON.stringify(f)),l()}})},S=t=>{J(t).then(c=>{if(c.status){let g={name:t.name,email:t.email,website:t.website};localStorage.setItem("ZY-CLIENT-USERINFO",JSON.stringify(g)),m(1)}})},l=()=>{D(o.query).then(t=>{o.messageList=t.data.result,o.total=t.data.total+t.data.repliesCount,o.query.pagination.total=t.data.total,o.query.pagination.current=t.data.current,o.query.pagination.pageSize=t.data.pageSize})};return l(),(t,c)=>{const g=b("a-empty"),_=b("a-pagination");return s(),a("section",he,[h(B,{title:"Guestbook",disBgAnimate:"",subTitle:" Leave your footprints and let me know you read my message here . ",current:"Contact"}),n("section",ke,[n("section",ge,[h(N,{title:"Drop a note",titleNum:"01"}),h(w,{onSubmitForm:S})]),ye,h(N,{title:"Drop a note",titleNum:"02"}),o.messageList.length?i("",!0):(s(),y(g,{key:0})),o.messageList.length?(s(),a(p,{key:1},[n("section",_e,[n("h4",be,r(o.total)+" footprints so far",1)]),n("section",Ie,[(s(!0),a(p,null,x(o.messageList,f=>(s(),y(A,{key:f._id,comment:f,class:"comment-item",onReply:v,onLike:k,onOppose:I},{default:u(()=>[f.repliesInfo.length?(s(!0),a(p,{key:0},x(f.repliesInfo,$=>(s(),y(A,{pid:f._id,key:$._id,comment:$,onLike:k,onOppose:I,onReply:v},null,8,["pid","comment"]))),128)):i("",!0)]),_:2},1032,["comment"]))),128)),o.query.pagination.total>o.query.pagination.pageSize?(s(),a("div",ve,[h(_,{current:o.query.pagination.current,"onUpdate:current":c[0]||(c[0]=f=>o.query.pagination.current=f),pageSize:o.query.pagination.pageSize,total:o.query.pagination.total,onChange:m,"show-less-items":""},null,8,["current","pageSize","total"])])):i("",!0)])],64)):i("",!0)])])}}},Re=F(Se,[["__scopeId","data-v-e2ed695c"]]);export{Re as default};
